# Введение в Express Framework

## Обзор Express: что это такое, зачем он нужен

Express.js, или просто Express, является минималистичным и гибким фреймворком веб-приложений для Node.js, предоставляющим набор мощных функций для создания веб-приложений и API. Он был разработан для упрощения процесса разработки серверной части приложений, облегчая работу с маршрутами, запросами и ответами, а также с взаимодействием с базами данных.

### Что такое Express?

Express — это фреймворк для Node.js, который облегчает создание серверных приложений, веб-сайтов и API. Он действует как промежуточное ПО (middleware), позволяя разработчикам легко и быстро реализовывать маршрутизацию, обработку запросов и отправку ответов. Express предоставляет набор основных функций для веб-разработки, таких как:

-   **Маршрутизация**: Управление запросами к определённым URL-адресам, что позволяет разработчикам легко создавать веб-страницы и API.
-   **Поддержка мидлваров**: Промежуточные обработчики, которые могут выполнять код, изменять объекты запросов и ответов, завершать цикл запрос-ответ или вызывать следующие функции в стеке.
-   **Шаблонизация**: Возможность использования движков шаблонов для генерации динамического HTML-контента на стороне сервера.
-   **Упрощение работы с запросами и ответами**: Удобные методы для обработки входящих данных и отправки ответов клиенту.

### Зачем нужен Express?

-   **Ускорение разработки**: Express упрощает процесс разработки серверной части, предоставляя простые средства для маршрутизации и обработки запросов, что значительно сокращает количество необходимого кода.
-   **Гибкость**: Благодаря своей минималистичной природе, Express не навязывает строгой структуры проекта, позволяя разработчикам свободно организовывать свои приложения.
-   **Расширяемость**: Express можно легко расширять с помощью мидлваров и различных пакетов npm, что позволяет добавлять новую функциональность по мере необходимости.
-   **Большое сообщество и экосистема**: Express имеет широкое сообщество разработчиков и богатую экосистему плагинов и инструментов, что обеспечивает хорошую поддержку и множество ресурсов для обучения.

## Различия между Express и встроенным веб-модулем Node.js

### Встроенный HTTP-модуль Node.js

Node.js поставляется с встроенным модулем HTTP, который позволяет Node.js передавать данные через интернет. HTTP-модуль является низкоуровневым API, предназначенным для обработки запросов и ответов HTTP.

**Особенности:**

-   **Низкоуровневый API**: Прямое управление запросами и ответами, больше контроля над обработкой соединений.
-   **Не требует внешних зависимостей**: Всё, что нужно для создания сервера, уже включено в Node.js.
-   **Гибкость**: Вы полностью контролируете обработку запросов и можете настроить сервер по своему усмотрению.

**Недостатки:**

-   **Больше кода для простых задач**: Для выполнения даже базовых операций, таких как маршрутизация, требуется написать больше кода.
-   **Сложность в управлении**: Может быть сложно управлять сложными приложениями из-за необходимости ручного управления каждым аспектом обработки запросов.

### Express.js

Express.js — это фреймворк для приложений веб-серверов на Node.js, предоставляющий сильную абстракцию высокого уровня для управления запросами и ответами HTTP. Express упрощает разработку веб-приложений и API.

**Особенности:**

-   **Упрощение маршрутизации**: Express предоставляет простой интерфейс для маршрутизации, позволяя легко определять обработчики для разных HTTP-методов и путей.
-   **Поддержка middleware**: Мощная система промежуточных обработчиков (middleware) позволяет легко добавлять функционал для обработки запросов, изменения ответов, ведения журналов и многое другое.
-   **Шаблонизация**: Встроенная поддержка различных шаблонизаторов для генерации HTML на стороне сервера.
-   **Упрощение обработки ошибок**: Express упрощает управление ошибками благодаря механизмам промежуточной обработки и специальным методам для обработки ошибок.

**Недостатки:**

-   **Зависимости**: Для работы Express требуется установка через NPM, что добавляет внешние зависимости в проект.
-   **Меньше контроля**: Поскольку Express абстрагирует многие аспекты управления HTTP-соединениями, разработчикам может не хватать некоторого уровня контроля, доступного при использовании встроенного модуля HTTP.

## Установка Express и создание базового сервера

### Создание нового проекта

Создайте новую папку для вашего проекта и перейдите в неё с помощью командной строки или терминала. Например:

```bash
mkdir my-express-app
cd my-express-app
```

Затем инициализируйте новый проект Node.js, используя `npm` (Node Package Manager), который устанавливается вместе с Node.js. Это создаст файл `package.json`, который отслеживает информацию о проекте и его зависимостях.

```bash
npm init -y
```

### Установка Express

Установите Express в ваш проект с помощью `npm`:

```bash
npm install express
```

Эта команда добавит Express в список зависимостей в вашем файле `package.json` и скачает его в папку `node_modules`.

### Создание базового сервера

Создайте файл `index.js` (или любое другое имя, которое вы предпочитаете) в корне вашего проекта:

```bash
touch index.js
```

Откройте этот файл в вашем любимом текстовом редакторе и добавьте следующий код для создания базового сервера на Express:

```javascript
const express = require("express");
const app = express();
const port = 3000;

app.get("/", (req, res) => {
    res.send("Привет мир!");
});

app.listen(port, () => {
    console.log(`Сервер запущен на http://localhost:${port}`);
});
```

Этот код создает экземпляр приложения Express и настраивает его на прослушивание HTTP-запросов на порту 3000. При обращении к корневому URL (`/`) сервер отправит ответ "Привет мир!".

### Запуск сервера

Вернитесь в терминал или командную строку и запустите сервер с помощью команды:

```bash
node index.js
```

Если всё сделано правильно, вы увидите сообщение "Сервер запущен на http://localhost:3000". Откройте браузер и перейдите по этому адресу, чтобы увидеть ответ вашего сервера.

## Промежуточное ПО

Промежуточное программное обеспечение (middleware) в Express играет ключевую роль в обработке HTTP-запросов и ответов. Middleware функции могут выполнять различные задачи: от обработки запросов данных до выполнения кода, изменения объектов запроса и ответа, завершения цикла запрос-ответ и вызова следующего middleware в стеке.

### Как работает Middleware

Middleware функции добавляются в приложение Express через методы `app.use()` и `app.METHOD()`, где `METHOD` может быть любым из HTTP-методов, например, `get`, `post`, `put` и т.д. Эти функции имеют доступ к объектам запроса (`req`), ответа (`res`) и к следующей функции middleware в цикле запроса-ответа (`next`).

### Примеры использования Middleware

#### Логирование запросов

```javascript
app.use((req, res, next) => {
    console.log("Time:", Date.now(), " - Path:", req.path);
    next();
});
```

Этот пример middleware логирует время и путь каждого запроса к серверу.

#### Аутентификация пользователя

```javascript
app.use((req, res, next) => {
    if (req.isAuthenticated()) {
        next();
    } else {
        res.status(403).send("Необходима аутентификация");
    }
});
```

Middleware для проверки аутентификации пользователя перед доступом к защищенным ресурсам.

#### Обработка статических файлов

```javascript
app.use(express.static("public"));
```

Express предоставляет встроенное middleware `express.static` для обслуживания статических файлов, таких как изображения, CSS и JavaScript файлы из указанной директории (`public` в данном примере).

#### Обработка ошибок

Middleware для обработки ошибок определяется с четырьмя аргументами и должно быть добавлено в конец стека middleware:

```javascript
app.use((err, req, res, next) => {
    console.error(err.stack);
    res.status(500).send("Что-то пошло не так!");
});
```

#### Парсинг тела запроса

Express использует `body-parser` middleware (теперь встроен в Express) для разбора тела запроса:

```javascript
app.use(express.json()); // Для парсинга application/json
app.use(express.urlencoded({ extended: true })); // Для парсинга application/x-www-form-urlencoded
```

### Создание собственного Middleware

Вы можете создать собственное middleware для выполнения специфических задач. Вот простой пример:

```javascript
const myLogger = (req, res, next) => {
    console.log("Logged");
    next();
};

app.use(myLogger);
```

Этот код создает middleware, которое просто выводит сообщение "Logged" при каждом запросе к серверу.

## Основы маршрутизации в Express

Маршрутизация в Express — это способ определения того, как приложение отвечает на клиентский запрос к определенному конечному URL-адресу (URI) и конкретному HTTP-методу (GET, POST и т.д.). Каждый маршрут может иметь один или несколько обработчиков функций, которые выполняются, когда совпадает маршрут.

### Основные концепции маршрутизации

-   **Маршрут**: Путь и метод запроса (например, GET или POST), определённый в приложении.
-   **Обработчик маршрута**: Функция, вызываемая при совпадении маршрута. Может быть одна или несколько функций.
-   **Middleware (промежуточное ПО)**: Функции, выполняемые в процессе обработки запроса, до того, как будет отправлен ответ.

### Создание базового маршрута

Маршруты в Express задаются с помощью методов приложения, соответствующих HTTP-методам: `get`, `post`, `put`, `delete` и так далее. Вот пример создания базового маршрута для обработки GET-запросов:

```javascript
app.get("/", (req, res) => {
    res.send("Привет, мир!");
});
```

В этом примере, при запросе к корневому URL (`'/'`) будет отправлен ответ `'Привет, мир!'`.

### Использование параметров маршрута

Параметры маршрута используются для захвата значений из URL. Они указываются в пути маршрута с помощью двоеточия `:` перед именем параметра:

```javascript
app.get("/users/:userId/books/:bookId", (req, res) => {
    res.send(req.params);
});
```

В этом примере, для запроса к `/users/34/books/8989`, `req.params` будет `{ userId: '34', bookId: '8989' }`.

### Работа с Query String

Параметры строки запроса (Query String) доступны через `req.query`. Это позволяет легко работать с GET-запросами, содержащими данные в URL после знака вопроса `?`:

```javascript
app.get("/search", (req, res) => {
    res.send(req.query);
});
```

Если кто-то сделает запрос к `/search?keyword=nodejs`, то `req.query` будет `{ keyword: 'nodejs' }`.

### Использование Middleware

Middleware — это функции, которые могут выполняться перед обработчиками маршрутов. Они могут изменять объекты запроса и ответа, завершать цикл запрос-ответ или вызывать следующий middleware в стеке:

```javascript
app.use((req, res, next) => {
    console.log("Time:", Date.now());
    next();
});

app.get("/", (req, res) => {
    res.send("Middleware демонстрация");
});
```

В этом примере, `app.use` определяет middleware, который будет выполнен для каждого запроса к приложению, выводя текущее время. Функция `next()` используется для передачи управления следующему обработчику.

### Обработка ошибок

Express позволяет определять специальные middleware для обработки ошибок, которые должны быть определены с четырьмя аргументами: `(err, req, res, next)`:

```javascript
app.use((err, req, res, next) => {
    console.error(err.stack);
    res.status(500).send("Что-то сломалось!");
});
```

Такой обработчик ошибок должен быть добавлен после всех других обработчиков и маршрутов.
